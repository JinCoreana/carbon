import { useState } from "react";
import { Meta, Story, Preview } from "@storybook/addon-docs";
import { action } from "@storybook/addon-actions";

import { DraggableContext, WithDrag, WithDrop } from ".";
import {
  FlatTable,
  FlatTableHead,
  FlatTableBody,
  FlatTableRow,
  FlatTableHeader,
  FlatTableCell,
} from "../flat-table";

<Meta
  title="DraggableContext/Test"
  parameters={{
    info: { disable: true },
    chromatic: {
      disable: true,
    },
  }}
  argTypes={{
    customDragLayer: { table: { disable: true } },
    onDrag: { table: { disable: true } },
    children: { table: { disable: true } },
  }}
/>
;

export const DraggableContextStory = ({ autoScroll }) => {
  const [state, setState] = useState([
    {
      id: "0",
      name: "UK",
    },
    {
      id: "1",
      name: "Germany",
    },
    {
      id: "2",
      name: "China",
    },
    {
      id: "3",
      name: "US",
    },
  ]);
  const handleDrag = (originalIndex, newIndex) => {
    const sortedItem = state[originalIndex];
    const newArr = [...state];
    newArr.splice(originalIndex, 1);
    newArr.splice(newIndex, 0, sortedItem);
    setState(newArr);
    action("drag")();
  };
  return (
    <DraggableContext onDrag={handleDrag} autoScroll={autoScroll}>
      <div>
        <FlatTable tbody={false}>
          <FlatTableHead>
            <FlatTableRow>
              <FlatTableHeader />
              <FlatTableHeader>Country</FlatTableHeader>
            </FlatTableRow>
          </FlatTableHead>
          <FlatTableBody>
            {state.map((row, index) => (
              <FlatTableRow key={row.id} uniqueID={row.id} index={index}>
                <FlatTableCell>{row.name}</FlatTableCell>
              </FlatTableRow>
            ))}
          </FlatTableBody>
        </FlatTable>
      </div>
    </DraggableContext>
  );
};

# Draggable Context

### Default

<Preview>
  <Story
    name="default"
    args={{
      autoScroll: true,
    }}
  >
    {DraggableContextStory.bind({})}
  </Story>
</Preview>
